{% extends 'base_admin.html' %}

{% block title %}Oyun İndir{% endblock %}

{% block content %}
    <div class="page-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <h1 class="page-title">Oyun İndir</h1>
                <p class="page-description">Oyunlarınızı indirin ve yönetin</p>
            </div>
            <button onclick="openDownloadSettings()" class="filter-btn filter-btn-primary" style="display: flex; align-items: center; gap: 0.5rem;">
                <i class="fas fa-cog"></i>
                İndirme Ayarları
            </button>
        </div>
    </div>

    <!-- İstatistik Kartları -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-icon">
                    <i class="fas fa-download"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-label">Aktif İndirmeler</div>
                    <div class="stat-value">2</div>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-icon green">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-label">Tamamlanan</div>
                    <div class="stat-value">1</div>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-icon amber">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-label">Toplam Hız</div>
                    <div class="stat-value" id="totalSpeedValue">25.3 MB/s</div>
                </div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <div class="stat-icon purple">
                    <i class="fas fa-gamepad"></i>
                </div>
                <div class="stat-info">
                    <div class="stat-label">Mevcut Oyunlar</div>
                    <div class="stat-value">12</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Aktif İndirmeler -->
    <div class="section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-spinner fa-spin" style="color: #60a5fa; margin-right: 8px;"></i>
                Aktif İndirmeler
            </h2>
        </div>

        <div class="card" style="margin-bottom: 1.5rem;">
            <div style="display: flex; align-items: flex-start; gap: 1.5rem; margin-bottom: 1.5rem;">
                <div style="position: relative;">
                    <img src="/static/images/covers/4-GTAV.webp" alt="GTA V" 
                         style="width: 80px; height: 120px; object-fit: cover; border-radius: 0.5rem;">
                    <div style="position: absolute; top: 6px; right: 6px; width: 12px; height: 12px; background: #22c55e; border-radius: 50%; border: 2px solid white; animation: pulse 2s infinite;"></div>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                        <div>
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0 0 0.5rem 0;">Grand Theft Auto V</h3>
                            <div style="display: flex; gap: 1rem; color: var(--muted-foreground); font-size: 0.875rem;">
                                <span><i class="fas fa-hdd" style="margin-right: 6px;"></i>45.2 GB / 94.5 GB</span>
                                <span><i class="fas fa-tachometer-alt" style="margin-right: 6px;"></i>12.5 MB/s</span>
                                <span><i class="fas fa-clock" style="margin-right: 6px;"></i>Kalan: 1s 5d</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="pauseDownload(1)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); color: #fbbf24; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-pause"></i>
                            </button>
                            <button onclick="cancelDownload(1)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- İlerleme Çubuğu -->
                    <div style="background: var(--muted); border-radius: 9999px; height: 0.5rem; margin-bottom: 0.75rem; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #60a5fa, #3b82f6); height: 100%; width: 48%; transition: width 0.3s;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--muted-foreground);">
                        <span style="font-weight: 600; color: var(--foreground);">%48 Tamamlandı</span>
                        <span>48.7 GB İşlendi</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom: 1.5rem; opacity: 0.8;">
            <div style="display: flex; align-items: flex-start; gap: 1.5rem;">
                <div style="position: relative;">
                    <img src="/static/images/covers/9-GodofWar.webp" alt="God of War" 
                         style="width: 80px; height: 120px; object-fit: cover; border-radius: 0.5rem;">
                    <div style="position: absolute; top: 6px; right: 6px; width: 12px; height: 12px; background: #fbbf24; border-radius: 50%; border: 2px solid white;"></div>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                        <div>
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0 0 0.5rem 0;">
                                God of War
                                <span style="background: rgba(251, 191, 36, 0.1); color: #fbbf24; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; margin-left: 0.75rem; font-weight: 500;">
                                    <i class="fas fa-pause"></i> DURAKLATILDI
                                </span>
                            </h3>
                            <div style="display: flex; gap: 1rem; color: var(--muted-foreground); font-size: 0.875rem;">
                                <span><i class="fas fa-hdd" style="margin-right: 6px;"></i>23.8 GB / 68.3 GB</span>
                                <span><i class="fas fa-pause" style="margin-right: 6px;"></i>Duraklatıldı</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="resumeDownload(2)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-play"></i>
                            </button>
                            <button onclick="cancelDownload(2)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>

                    <!-- İlerleme Çubuğu -->
                    <div style="background: var(--muted); border-radius: 9999px; height: 0.5rem; margin-bottom: 0.75rem; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #fbbf24, #f59e0b); height: 100%; width: 35%; transition: width 0.3s;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--muted-foreground);">
                        <span style="font-weight: 600; color: var(--foreground);">%35 Tamamlandı</span>
                        <span>23.8 GB İşlendi</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tamamlanan İndirmeler -->
    <div class="section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-check-circle" style="color: #22c55e; margin-right: 8px;"></i>
                Tamamlanan İndirmeler
            </h2>
        </div>

        <div class="card">
            <div style="display: flex; align-items: flex-start; gap: 1.5rem; margin-bottom: 1.5rem;">
                <div style="position: relative;">
                    <img src="/static/images/covers/5-SonsOfTheForest.webp" alt="Sons of the Forest" 
                         style="width: 80px; height: 120px; object-fit: cover; border-radius: 0.5rem;">
                    <div style="position: absolute; top: 6px; right: 6px; width: 12px; height: 12px; background: #22c55e; border-radius: 50%; border: 2px solid white;"></div>
                </div>
                <div style="flex: 1; min-width: 0;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.75rem;">
                        <div>
                            <h3 style="font-size: 1.125rem; font-weight: 600; margin: 0 0 0.5rem 0;">
                                Sons of the Forest
                                <span style="background: rgba(34, 197, 94, 0.1); color: #22c55e; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; margin-left: 0.75rem; font-weight: 500;">
                                    <i class="fas fa-check"></i> TAMAMLANDI
                                </span>
                            </h3>
                            <div style="display: flex; gap: 1rem; color: var(--muted-foreground); font-size: 0.875rem;">
                                <span><i class="fas fa-hdd" style="margin-right: 6px;"></i>12.5 GB</span>
                                <span><i class="fas fa-calendar" style="margin-right: 6px;"></i>19 Ekim 2025, 14:23</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button onclick="installGame(3)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #22c55e; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-cog"></i>
                            </button>
                            <button onclick="openFolder(3)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(100, 116, 139, 0.1); border: 1px solid rgba(100, 116, 139, 0.3); color: #64748b; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-folder"></i>
                            </button>
                            <button onclick="deleteDownload(3)" 
                                    style="width: 2rem; height: 2rem; border-radius: 0.375rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <!-- İlerleme Çubuğu -->
                    <div style="background: var(--muted); border-radius: 9999px; height: 0.5rem; margin-bottom: 0.75rem; overflow: hidden;">
                        <div style="background: linear-gradient(90deg, #22c55e, #34d399); height: 100%; width: 100%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.875rem; color: var(--muted-foreground); margin-bottom: 1.5rem;">
                        <span style="font-weight: 600; color: #22c55e;">%100 Tamamlandı</span>
                        <span>12.5 GB İşlendi</span>
                    </div>

                    <!-- Kurulum Bölümü -->
                    <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 1rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                        <div style="margin-bottom: 1rem;">
                            <label style="display: block; color: var(--foreground); font-weight: 600; margin-bottom: 0.5rem; font-size: 0.875rem;">
                                <i class="fas fa-map-marker-alt" style="margin-right: 6px;"></i>Kurulum Yolu:
                            </label>
                            <div style="display: flex; gap: 0.5rem;">
                                <input type="text" id="installPath3" value="C:\Program Files\Zenith Games\Sons of the Forest" readonly
                                       style="flex: 1; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem 0.75rem; color: var(--foreground); font-size: 0.875rem;">
                                <button onclick="browsePath(3)" 
                                        style="padding: 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                                    <i class="fas fa-folder-open"></i>
                                </button>
                            </div>
                        </div>
                        <button onclick="startInstallation(3)" 
                                style="width: 100%; padding: 0.75rem; background: linear-gradient(135deg, #22c55e, #34d399); border: none; border-radius: 0.5rem; color: white; font-weight: 600; cursor: pointer; font-size: 0.875rem; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                            <i class="fas fa-cog"></i>
                            Oyunu Kur
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- İndirilebilir Oyunlar -->
    <div class="section">
        <div class="section-header">
            <h2 class="section-title">
                <i class="fas fa-gamepad" style="color: #a78bfa; margin-right: 8px;"></i>
                İndirilebilir Oyunlar
            </h2>
            <div style="display: flex; gap: 1rem; align-items: center;">
                <div style="position: relative;">
                    <input type="text" placeholder="Oyun ara..." id="gameSearch"
                           style="padding: 0.5rem 2.5rem 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); font-size: 0.875rem; width: 200px;">
                    <i class="fas fa-search" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); color: var(--muted-foreground);"></i>
                </div>
                <select id="categoryFilter" 
                        style="padding: 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); font-size: 0.875rem; cursor: pointer;">
                    <option value="">Tüm Kategoriler</option>
                    <option value="action">Aksiyon</option>
                    <option value="adventure">Macera</option>
                    <option value="racing">Yarış</option>
                    <option value="survival">Hayatta Kalma</option>
                </select>
            </div>
        </div>

        <div class="games-grid" id="gamesGrid">
            <!-- Oyun Kartı 1 -->
            <div class="game-card" data-game-id="4">
                <div class="game-card-actions">
                    <button onclick="startDownload(4)" class="game-card-action-btn edit" title="İndir">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <img src="/static/images/covers/3-Blur.webp" alt="Blur" class="game-card-cover">
                <div class="game-card-content">
                    <div class="game-card-title">Blur</div>
                    <div class="game-card-category">Yarış</div>
                    <div class="game-card-stats">
                        <span class="badge active">8.2 GB</span>
                        <span class="game-card-clicks">4.5 ★</span>
                    </div>
                </div>
            </div>

            <!-- Oyun Kartı 2 -->
            <div class="game-card" data-game-id="5">
                <div class="game-card-actions">
                    <button onclick="startDownload(5)" class="game-card-action-btn edit" title="İndir">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <img src="/static/images/covers/6-TheForest.webp" alt="The Forest" class="game-card-cover">
                <div class="game-card-content">
                    <div class="game-card-title">The Forest</div>
                    <div class="game-card-category">Hayatta Kalma</div>
                    <div class="game-card-stats">
                        <span class="badge active">5.8 GB</span>
                        <span class="game-card-clicks">4.7 ★</span>
                    </div>
                </div>
            </div>

            <!-- Oyun Kartı 3 -->
            <div class="game-card" data-game-id="6">
                <div class="game-card-actions">
                    <button onclick="startDownload(6)" class="game-card-action-btn edit" title="İndir">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
                <img src="/static/images/covers/8-TheLongDark.webp" alt="The Long Dark" class="game-card-cover">
                <div class="game-card-content">
                    <div class="game-card-title">The Long Dark</div>
                    <div class="game-card-category">Hayatta Kalma</div>
                    <div class="game-card-stats">
                        <span class="badge active">3.2 GB</span>
                        <span class="game-card-clicks">4.3 ★</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- İndirme Ayarları Modal -->
    <div id="downloadSettingsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 1000; align-items: center; justify-content: center;">
        <div style="background: var(--card); border-radius: var(--radius); padding: 2rem; width: 90%; max-width: 600px; border: 1px solid var(--border);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                <h2 style="font-size: 1.5rem; font-weight: 600; color: var(--foreground); margin: 0;">
                    <i class="fas fa-cog" style="margin-right: 8px; color: #60a5fa;"></i>
                    İndirme Ayarları
                </h2>
                <button onclick="closeDownloadSettings()" style="background: none; border: none; color: var(--muted-foreground); font-size: 1.5rem; cursor: pointer; padding: 0.5rem;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- Hız Limiti Ayarı -->
                <div>
                    <label style="display: block; color: var(--foreground); font-weight: 600; margin-bottom: 0.75rem; font-size: 0.875rem;">
                        <i class="fas fa-tachometer-alt" style="margin-right: 6px;"></i>
                        Varsayılan İndirme Hız Limiti
                    </label>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <input type="range" id="globalSpeedLimit" min="1" max="100" value="50" 
                               style="flex: 1; height: 6px; border-radius: 3px; background: var(--muted); outline: none; -webkit-appearance: none; cursor: pointer;"
                               oninput="updateGlobalSpeed(this.value)">
                        <span id="globalSpeedValue" style="color: var(--foreground); font-weight: 600; min-width: 80px; text-align: right; font-size: 0.875rem;">50 MB/s</span>
                    </div>
                    <p style="color: var(--muted-foreground); font-size: 0.75rem; margin-top: 0.5rem;">Tüm yeni indirmeler için varsayılan hız limitini belirler.</p>
                </div>

                <!-- İndirme Diski -->
                <div>
                    <label style="display: block; color: var(--foreground); font-weight: 600; margin-bottom: 0.75rem; font-size: 0.875rem;">
                        <i class="fas fa-hdd" style="margin-right: 6px;"></i>
                        İndirme Diski
                    </label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="downloadDisk" value="D:\Downloads\Zenith" 
                               style="flex: 1; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem 0.75rem; color: var(--foreground); font-size: 0.875rem;">
                        <button onclick="browseDownloadDisk()" 
                                style="padding: 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                            <i class="fas fa-folder-open"></i>
                        </button>
                    </div>
                    <p style="color: var(--muted-foreground); font-size: 0.75rem; margin-top: 0.5rem;">Oyunların indirileceği varsayılan klasör.</p>
                </div>

                <!-- Kurulum Diski -->
                <div>
                    <label style="display: block; color: var(--foreground); font-weight: 600; margin-bottom: 0.75rem; font-size: 0.875rem;">
                        <i class="fas fa-cog" style="margin-right: 6px;"></i>
                        Kurulum Diski
                    </label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="installDisk" value="C:\Program Files\Zenith Games" 
                               style="flex: 1; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; padding: 0.5rem 0.75rem; color: var(--foreground); font-size: 0.875rem;">
                        <button onclick="browseInstallDisk()" 
                                style="padding: 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); cursor: pointer; font-size: 0.875rem; transition: all 0.2s;">
                            <i class="fas fa-folder-open"></i>
                        </button>
                    </div>
                    <p style="color: var(--muted-foreground); font-size: 0.75rem; margin-top: 0.5rem;">Oyunların kurulacağı varsayılan klasör.</p>
                </div>

                <!-- Eşzamanlı İndirme Sayısı -->
                <div>
                    <label style="display: block; color: var(--foreground); font-weight: 600; margin-bottom: 0.75rem; font-size: 0.875rem;">
                        <i class="fas fa-layer-group" style="margin-right: 6px;"></i>
                        Eşzamanlı İndirme Sayısı
                    </label>
                    <select id="concurrentDownloads" style="width: 100%; padding: 0.5rem 0.75rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); font-size: 0.875rem; cursor: pointer;">
                        <option value="1">1 İndirme</option>
                        <option value="2" selected>2 İndirme</option>
                        <option value="3">3 İndirme</option>
                        <option value="5">5 İndirme</option>
                        <option value="0">Sınırsız</option>
                    </select>
                    <p style="color: var(--muted-foreground); font-size: 0.75rem; margin-top: 0.5rem;">Aynı anda yapılacak maksimum indirme sayısı.</p>
                </div>

                <!-- Otomatik Kurulum -->
                <div>
                    <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;">
                        <input type="checkbox" id="autoInstall" style="width: 1.25rem; height: 1.25rem; cursor: pointer;">
                        <span style="color: var(--foreground); font-weight: 600; font-size: 0.875rem;">
                            <i class="fas fa-robot" style="margin-right: 6px;"></i>
                            İndirme Tamamlanınca Otomatik Kur
                        </span>
                    </label>
                    <p style="color: var(--muted-foreground); font-size: 0.75rem; margin-top: 0.5rem; margin-left: 2rem;">İndirme bittiğinde oyunu otomatik olarak kurar.</p>
                </div>
            </div>

            <!-- Modal Butonları -->
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
                <button onclick="closeDownloadSettings()" 
                        style="padding: 0.75rem 1.5rem; background: var(--muted); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--foreground); cursor: pointer; font-size: 0.875rem; font-weight: 500; transition: all 0.2s;">
                    İptal
                </button>
                <button onclick="saveDownloadSettings()" 
                        style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #60a5fa, #3b82f6); border: none; border-radius: 0.5rem; color: white; cursor: pointer; font-size: 0.875rem; font-weight: 600; transition: all 0.2s;">
                    <i class="fas fa-save" style="margin-right: 0.5rem;"></i>
                    Ayarları Kaydet
                </button>
            </div>
        </div>
    </div>

    <style>
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #60a5fa;
            border-radius: 50%;
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #60a5fa;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        input[type="checkbox"] {
            accent-color: #60a5fa;
        }
    </style>
{% endblock %}

{% block scripts %}
<script>
// İndirme yönetimi fonksiyonları
function pauseDownload(gameId) {
    console.log('İndirme duraklatılıyor:', gameId);
    showNotification('İndirme duraklatıldı', 'warning');
}

function resumeDownload(gameId) {
    console.log('İndirme devam ettiriliyor:', gameId);
    showNotification('İndirme devam ettiriliyor', 'success');
}

function cancelDownload(gameId) {
    if (confirm('Bu indirmeyi iptal etmek istediğinizden emin misiniz?')) {
        console.log('İndirme iptal ediliyor:', gameId);
        showNotification('İndirme iptal edildi', 'error');
    }
}

function startDownload(gameId) {
    console.log('İndirme başlatılıyor:', gameId);
    showNotification('İndirme başlatıldı', 'success');
}

function installGame(gameId) {
    const defaultPath = document.getElementById('installDisk').value;
    const path = prompt('Oyunun kurulacağı yolu girin:', defaultPath + '\\Sons of the Forest');
    if (path) {
        console.log('Oyun kuruluyor:', gameId, 'Yol:', path);
        showNotification('Kurulum başlatıldı', 'success');
    }
}

function openFolder(gameId) {
    console.log('Klasör açılıyor:', gameId);
}

function deleteDownload(gameId) {
    if (confirm('Bu indirmeyi silmek istediğinizden emin misiniz?')) {
        console.log('İndirme siliniyor:', gameId);
        showNotification('İndirme silindi', 'success');
    }
}

function browsePath(gameId) {
    showNotification('Klasör seçici açıldı', 'info');
}

function startInstallation(gameId) {
    console.log('Kurulum başlatılıyor:', gameId);
    showNotification('Kurulum başlatıldı', 'success');
}

// Ayarlar modal fonksiyonları
function openDownloadSettings() {
    document.getElementById('downloadSettingsModal').style.display = 'flex';
    loadDownloadSettings();
}

function closeDownloadSettings() {
    document.getElementById('downloadSettingsModal').style.display = 'none';
}

function updateGlobalSpeed(value) {
    document.getElementById('globalSpeedValue').textContent = value + ' MB/s';
}

function browseDownloadDisk() {
    showNotification('İndirme diski seçici açıldı', 'info');
}

function browseInstallDisk() {
    showNotification('Kurulum diski seçici açıldı', 'info');
}

function loadDownloadSettings() {
    // Ayarları localStorage'dan yükle
    const settings = JSON.parse(localStorage.getItem('downloadSettings') || '{}');
    
    document.getElementById('globalSpeedLimit').value = settings.speedLimit || 50;
    document.getElementById('globalSpeedValue').textContent = (settings.speedLimit || 50) + ' MB/s';
    document.getElementById('downloadDisk').value = settings.downloadDisk || 'D:\\Downloads\\Zenith';
    document.getElementById('installDisk').value = settings.installDisk || 'C:\\Program Files\\Zenith Games';
    document.getElementById('concurrentDownloads').value = settings.concurrentDownloads || 2;
    document.getElementById('autoInstall').checked = settings.autoInstall || false;
}

function saveDownloadSettings() {
    // Ayarları localStorage'a kaydet
    const settings = {
        speedLimit: document.getElementById('globalSpeedLimit').value,
        downloadDisk: document.getElementById('downloadDisk').value,
        installDisk: document.getElementById('installDisk').value,
        concurrentDownloads: document.getElementById('concurrentDownloads').value,
        autoInstall: document.getElementById('autoInstall').checked
    };
    
    localStorage.setItem('downloadSettings', JSON.stringify(settings));
    closeDownloadSettings();
    showNotification('Ayarlar başarıyla kaydedildi', 'success');
    
    // Toplam hız değerini güncelle
    document.getElementById('totalSpeedValue').textContent = settings.speedLimit + ' MB/s';
}

// Bildirim sistemi
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type}`;
    notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
        ${message}
        <button type="button" class="alert-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    const contentWrapper = document.querySelector('.content-wrapper');
    if (contentWrapper) {
        contentWrapper.insertBefore(notification, contentWrapper.firstChild);
        setTimeout(() => {
            notification.remove();
        }, 5000);
    }
}

// Arama ve filtreleme
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('gameSearch');
    const categoryFilter = document.getElementById('categoryFilter');
    
    if (searchInput) {
        searchInput.addEventListener('input', function() {
            filterGames();
        });
    }
    
    if (categoryFilter) {
        categoryFilter.addEventListener('change', function() {
            filterGames();
        });
    }
    
    function filterGames() {
        const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
        const category = categoryFilter ? categoryFilter.value : '';
        
        const gameCards = document.querySelectorAll('.game-card');
        
        gameCards.forEach(card => {
            const title = card.querySelector('.game-card-title').textContent.toLowerCase();
            const categoryText = card.querySelector('.game-card-category').textContent.toLowerCase();
            
            const matchesSearch = title.includes(searchTerm);
            const matchesCategory = !category || categoryText.includes(category.toLowerCase());
            
            if (matchesSearch && matchesCategory) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    // Ayarları yükle
    loadDownloadSettings();
});
</script>
{% endblock %}
